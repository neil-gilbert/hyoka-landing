---
interface Props {
	brandHref?: string;
	sourcePath?: string;
	joined?: boolean;
	errorCode?: string | null;
}

const {
	brandHref = '/',
	sourcePath = '/',
	joined = false,
	errorCode = null,
} = Astro.props;

const errorMessages: Record<string, string> = {
	invalid_email: 'Please enter a valid email address.',
	email_not_configured: 'Waitlist signup is temporarily unavailable. Please try again shortly.',
	delivery_failed: 'Could not submit your email right now. Please try again.',
};

const feedbackMessage = joined
	? "Thanks, you're on the waitlist. We'll be in touch soon."
	: errorCode
		? (errorMessages[errorCode] ?? 'Could not submit your email. Please try again.')
		: null;

const modalTitle = joined ? 'Thanks for joining' : 'Waitlist signup error';
---

<div class="home-v1-page" id="vanta-bg">
	<div class="home-v1-content">
		<nav class="home-v1-nav">
		<a class="home-v1-brand" href={brandHref} aria-label="Hyoka home">
			<span class="home-v1-brand-mark" aria-hidden="true"></span>
			<span>Hyoka</span>
		</a>
	</nav>

	<main class="home-v1-main">
		<div class="home-v1-shell">
			<h1 class="home-v1-headline">
				DATA<br />
				DRIVEN<br />
				<span>TRUTH.</span>
			</h1>

			<div class="home-v1-bottom">
				<p class="home-v1-subtitle">
					Stop relying on "vibes". Use Hyoka to mathematically prove your AI model&apos;s
					performance and cost-efficiency.
				</p>

				<div class="home-v1-cta">
					<p class="home-v1-cta-title">Join The Waitlist</p>
					<form class="home-v1-form" id="waitlist-signup" action="/api/waitlist" method="post">
						<label class="sr-only" for="waitlist-email">Email Address</label>
						<input type="hidden" name="sourcePath" value={sourcePath} />
						<input
							id="waitlist-email"
							name="email"
							type="email"
							placeholder="Email Address"
							autocomplete="email"
							required
						/>
						<button type="submit" aria-label="Join waitlist">â†’</button>
					</form>
				</div>
			</div>
		</div>
	</main>
	</div>

	{
		feedbackMessage && (
			<div class="home-v1-modal-backdrop">
				<section
					class:list={['home-v1-modal', joined ? 'is-success' : 'is-error']}
					role="dialog"
					aria-modal="true"
					aria-labelledby="waitlist-modal-title"
				>
					<h2 id="waitlist-modal-title">{modalTitle}</h2>
					<p>{feedbackMessage}</p>
					<a href={sourcePath} class="home-v1-modal-close">Close</a>
				</section>
			</div>
		)
	}
</div>

<script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script is:inline src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
<script is:inline>
	document.addEventListener('DOMContentLoaded', () => {
		try {
			VANTA.NET({
				el: "#vanta-bg",
				mouseControls: true,
				touchControls: true,
				gyroControls: false,
				minHeight: 200.00,
				minWidth: 200.00,
				scale: 1.00,
				scaleMobile: 1.00,
				color: 0xff3f81,
				backgroundColor: 0xffffff,
				points: 10.00,
				maxDistance: 22.00,
				spacing: 18.00
			})
		} catch (e) {
			console.error("Vanta error:", e);
		}
	});
</script>

<style>
	:global(body.home-v1-body) {
		margin: 0;
		background: #fff;
		color: #14233c;
		font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial,
			sans-serif;
		font-size: 16px;
		line-height: 1.4;
	}

	.home-v1-page {
		--hyoka-navy: #14233c;
		--hyoka-orange: #ff4d4d;
		min-height: 100vh;
		color: var(--hyoka-navy);
		background: #fff;
		position: relative;
		overflow: hidden;
	}

	.home-v1-content {
		position: relative;
		z-index: 1;
		display: flex;
		flex-direction: column;
		/* Removed min-height from here as it might conflict with flex behavior in some contexts if not handled right */
	}

	.home-v1-nav {
		padding: 40px 60px;
		display: flex;
		justify-content: flex-start;
		align-items: center;
		gap: 24px;
	}

	.home-v1-brand {
		display: inline-flex;
		align-items: center;
		gap: 12px;
		font-size: 24px;
		font-weight: 900;
		letter-spacing: -0.02em;
		color: var(--hyoka-navy);
		text-decoration: none;
	}

	.home-v1-brand-mark {
		width: 32px;
		height: 32px;
		background: var(--hyoka-navy);
		border-radius: 8px;
		display: inline-block;
	}

	.home-v1-main {
		flex: 1;
		width: 100%;
		max-width: none;
		margin: 0;
		padding: 0 60px 48px;
		display: flex;
		align-items: center;
	}

	.home-v1-shell {
		width: 100%;
		max-width: 1400px;
	}

	.home-v1-headline {
		font-size: clamp(72px, 12vw, 180px);
		font-weight: 900;
		line-height: 0.85;
		margin: 0 0 40px;
		letter-spacing: -0.05em;
		color: var(--hyoka-navy);
	}

	.home-v1-headline span {
		color: var(--hyoka-orange);
	}

	.home-v1-bottom {
		display: flex;
		align-items: flex-end;
		justify-content: space-between;
		flex-wrap: wrap;
		gap: 40px;
	}

	.home-v1-subtitle {
		font-size: 24px;
		color: #666;
		max-width: 500px;
		line-height: 1.4;
		font-weight: 500;
		margin: 0;
	}

	.home-v1-cta {
		width: 100%;
		max-width: 500px;
	}

	.home-v1-cta-title {
		margin: 0 0 10px;
		font-size: 18px;
		font-weight: 700;
		letter-spacing: 0.01em;
		color: var(--hyoka-navy);
	}

	.home-v1-form {
		display: flex;
		gap: 16px;
		width: 100%;
		max-width: 500px;
		scroll-margin-top: 32px;
	}

	.home-v1-form input {
		flex: 1;
		border: 2px solid var(--hyoka-navy);
		padding: 20px;
		font-size: 18px;
		border-radius: 0;
		outline: none;
		font-family: inherit;
	}

	.home-v1-form input:focus-visible {
		box-shadow: 0 0 0 4px rgba(20, 35, 60, 0.18);
	}

	.home-v1-form button {
		background: var(--hyoka-orange);
		color: #fff;
		border: none;
		padding: 0 40px;
		font-size: 18px;
		font-weight: 700;
		cursor: pointer;
		line-height: 1;
		transition: transform 0.15s ease, filter 0.15s ease;
	}

	.home-v1-form button:hover {
		transform: translateY(-1px);
		filter: brightness(1.08);
	}

	.home-v1-form button:focus-visible {
		outline: 3px solid rgba(255, 77, 77, 0.32);
		outline-offset: 2px;
	}

	.home-v1-modal-backdrop {
		position: fixed;
		inset: 0;
		padding: 24px;
		background: rgba(20, 35, 60, 0.4);
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: 20;
	}

	.home-v1-modal {
		width: min(460px, 100%);
		background: #fff;
		color: var(--hyoka-navy);
		border-radius: 16px;
		padding: 24px;
		box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
	}

	.home-v1-modal.is-success {
		border-top: 6px solid #1f7a45;
	}

	.home-v1-modal.is-error {
		border-top: 6px solid #b32727;
	}

	.home-v1-modal h2 {
		margin: 0 0 10px;
		font-size: 28px;
		line-height: 1.1;
	}

	.home-v1-modal p {
		margin: 0 0 20px;
		font-size: 17px;
		line-height: 1.5;
		color: #3b4f73;
	}

	.home-v1-modal-close {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		background: var(--hyoka-navy);
		color: #fff;
		text-decoration: none;
		padding: 11px 20px;
		border-radius: 10px;
		font-weight: 700;
	}

	.home-v1-modal-close:hover {
		filter: brightness(1.1);
	}

	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border: 0;
	}

	@media (max-width: 960px) {
		.home-v1-nav {
			padding: 28px 28px 16px;
			flex-wrap: wrap;
		}

		.home-v1-main {
			padding: 8px 28px 40px;
		}

		.home-v1-headline {
			font-size: clamp(52px, 18vw, 112px);
			line-height: 0.88;
			margin-bottom: 28px;
		}

		.home-v1-subtitle {
			font-size: 20px;
			max-width: 100%;
		}
	}

	@media (max-width: 640px) {
		.home-v1-form {
			max-width: 100%;
			gap: 10px;
		}

		.home-v1-form input {
			padding: 16px;
			font-size: 16px;
		}

		.home-v1-form button {
			padding: 0 24px;
			font-size: 16px;
		}
	}
</style>
